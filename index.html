<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TAITEQ ‚Äî Care Manager Diary</title>
  <meta name="description" content="Password-protected diary for care managers with voice notes, SOS, and offline queue.">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --navy:#0a1b2b; --navy-2:#0f2438; --gold:#FFD700; }
    @keyframes pulseGold { 0% { box-shadow:0 0 6px rgba(255,215,0,.6);} 50%{box-shadow:0 0 20px rgba(255,215,0,1);} 100%{box-shadow:0 0 6px rgba(255,215,0,.6);} }
    .glass { background: rgba(255,255,255,.08); backdrop-filter: blur(10px); }
    .btn { border-radius: 12px; }
    .btn-gold { background: linear-gradient(45deg,#FFD700,#FFC300,#FFB000); color: var(--navy); font-weight: 700; box-shadow: 0 0 12px rgba(255,215,0,.7); transition: all .2s; }
    .btn-gold:hover { filter: brightness(1.08); box-shadow: 0 0 24px rgba(255,215,0,1); }
    .sos-on { background: linear-gradient(45deg,#FFD700,#FFC300,#FFB000)!important; color:var(--navy)!important; border-color:transparent!important; animation:pulseGold 1.6s ease-in-out infinite; font-weight:700; }
    .chip { border-radius: 999px; border:1px solid rgb(71 85 105); padding:.35rem .75rem; }
    .chip-active { background:#fff; color: var(--navy); border-color: transparent; }

    /* Private badge styling */
    .badge {
      border-radius: 10px;
      padding: .25rem .65rem;
      font-weight: 700;
      background: linear-gradient(45deg, #10B981, #059669); /* emerald shades */
      color: #ECFDF5; /* mint text */
      border: none;
      box-shadow: 0 0 12px rgba(16,185,129,.6);
    }

    /* Save-button micro bounce */
    @keyframes btnBounce { 0%{transform:scale(1)} 45%{transform:scale(.98)} 100%{transform:scale(1)} }
    .btn-bounce { animation: btnBounce .18s ease-out; }

    /* Dramatic toast beside Save button (left side) */
    @keyframes popSlide {
      0%   { opacity:0; transform:scale(.8) translateY(8px); }
      60%  { opacity:1; transform:scale(1.05) translateY(-2px); }
      100% { opacity:1; transform:scale(1) translateY(0); }
    }
    .entry-toast {
      position:absolute;
      right:100%; top:50%;
      margin-right:.75rem;
      transform:translateY(-50%);
      background: linear-gradient(45deg,#FFD700,#FFC300,#FFB000);
      color:var(--navy);
      font-weight:700;
      padding:.6rem .8rem;
      border-radius:.75rem;
      box-shadow:0 6px 16px rgba(0,0,0,.25);
      opacity:0;
      pointer-events:none;
      white-space:nowrap;
    }
    .entry-toast.show { animation:popSlide .45s cubic-bezier(.22,.8,.3,1) forwards; }
  </style>
</head>
<body class="min-h-screen bg-[var(--navy)] text-slate-100 selection:bg-yellow-200/30">
  <div class="max-w-5xl mx-auto px-6 py-10">
    <!-- Header -->
    <header class="mb-8 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="h-12 w-12 rounded-xl grid place-items-center bg-white">
          <span class="text-[var(--navy)] font-bold text-lg">TQ</span>
        </div>
        <div>
          <h1 class="text-3xl md:text-4xl font-bold">TAITEQ ‚Äî Care Manager Diary</h1>
          <p class="text-sm md:text-base text-slate-300">Password ‚Ä¢ Voice notes ‚Ä¢ SOS ‚Ä¢ Offline-ready</p>
        </div>
      </div>
      <div class="text-sm md:text-base text-slate-300" id="lockStatus">üîí Locked</div>
    </header>

    <!-- Password Gate -->
    <section id="gate" class="max-w-3xl rounded-2xl border border-slate-700 p-8 glass mx-auto">
      <h2 class="text-2xl font-semibold">Enter password</h2>
      <p class="mt-2 text-base text-slate-300">Your diary is protected on this device.</p>
      <form id="gateForm" class="mt-6 grid grid-cols-1 gap-4 md:grid-cols-[1fr_auto] items-center" autocomplete="off">
        <input type="password" placeholder="Password"
               class="w-full rounded-xl border border-slate-600 bg-[var(--navy-2)] px-6 py-4 text-lg text-slate-100 placeholder:text-slate-400" required />
        <div class="flex items-center gap-5 md:justify-end">
          <label class="flex items-center gap-2 text-base text-slate-300">
            <input type="checkbox" id="rememberMe" class="h-5 w-5 rounded border-slate-500 bg-[var(--navy-2)]" />
            Remember me
          </label>
          <button class="btn btn-gold px-8 py-4 text-lg" type="submit">Unlock</button>
        </div>
      </form>
    </section>

    <!-- Diary -->
    <section id="diary" class="hidden mt-8 space-y-8">
      <div class="max-w-3xl mx-auto flex flex-wrap items-center gap-4">
        <span class="text-base text-slate-300">Mode:</span>
        <button id="quickBtn" class="chip chip-active text-sm">Quick</button>
        <button id="fullBtn" class="chip text-sm">Full</button>
        <span class="grow"></span>
        <button id="sosBtn" class="chip text-sm" title="Flag as critical">SOS</button>
      </div>

      <!-- QUICK MODE -->
      <form id="quickForm" class="max-w-3xl mx-auto rounded-2xl border border-slate-700 p-6 glass space-y-5">
        <label class="text-base">Pain point
          <textarea name="pain_point" rows="3"
            class="mt-2 w-full rounded-xl border border-slate-600 bg-[var(--navy-2)] px-4 py-3 text-slate-100"
            placeholder="What‚Äôs getting in the way right now?"></textarea>
        </label>
        <label class="text-base">Proposed solution / requirement
          <textarea name="proposed_solution" rows="2"
            class="mt-2 w-full rounded-xl border border-slate-600 bg-[var(--navy-2)] px-4 py-3 text-slate-100"
            placeholder="What would fix this or make it easier?"></textarea>
        </label>
        <fieldset class="text-base">
          <legend class="mb-2">Tag the area(s)</legend>
          <div class="grid grid-cols-2 gap-2">
            <label><input type="checkbox" name="tags" value="Medication"> Medication</label>
            <label><input type="checkbox" name="tags" value="Rota & Staffing"> Rota & Staffing</label>
            <label><input type="checkbox" name="tags" value="Care Notes/Logs"> Care Notes/Logs</label>
            <label><input type="checkbox" name="tags" value="Audits/Compliance"> Audits/Compliance</label>
            <label><input type="checkbox" name="tags" value="Handovers"> Handovers</label>
            <label><input type="checkbox" name="tags" value="Training"> Training</label>
            <label><input type="checkbox" name="tags" value="Family Communication"> Family Communication</label>
            <label><input type="checkbox" id="qOther" value="__OTHER__"> Other</label>
          </div>
          <input id="qOtherText" class="mt-2 w-full rounded-xl border border-slate-600 bg-[var(--navy-2)] px-4 py-3 text-slate-100 hidden" placeholder="Specify other‚Ä¶" />
        </fieldset>
        <div class="flex items-center gap-3 relative justify-end">
          <button id="quickSaveBtn" class="btn btn-gold px-7 py-3 text-lg" type="submit">Save entry</button>
          <div id="quickEntryToast" class="entry-toast">Thank you for trusting me with this! üòâ</div>
        </div>
      </form>

      <!-- FULL MODE -->
      <form id="fullForm" class="max-w-3xl mx-auto rounded-2xl border border-slate-700 p-6 glass space-y-5 hidden">
        <label class="text-base">How this pain point makes you feel
          <select name="mood" class="mt-2 w-full rounded-xl border border-slate-600 bg-[var(--navy-2)] px-4 py-3">
            <option value="1">üôÇ Calm</option>
            <option value="2">üòê Okay</option>
            <option value="3">üòï Tense</option>
            <option value="4">üò£ Stressed</option>
            <option value="5">üò´ Overwhelmed</option>
          </select>
        </label>
        <label class="text-base">Pain point
          <textarea name="pain_point" rows="3"
            class="mt-2 w-full rounded-xl border border-slate-600 bg-[var(--navy-2)] px-4 py-3 text-slate-100"
            placeholder="What‚Äôs the issue? Facts only."></textarea>
        </label>
        <label class="text-base">What would ‚Äúbetter‚Äù look like? (ideal)
          <textarea name="ideal" rows="2"
            class="mt-2 w-full rounded-xl border border-slate-600 bg-[var(--navy-2)] px-4 py-3 text-slate-100"
            placeholder="Describe the outcome or requirement."></textarea>
        </label>
        <fieldset class="text-base">
          <legend class="mb-2">Tag the area(s)</legend>
          <div class="grid grid-cols-2 gap-2">
            <label><input type="checkbox" name="tags" value="Medication"> Medication</label>
            <label><input type="checkbox" name="tags" value="Rota & Staffing"> Rota & Staffing</label>
            <label><input type="checkbox" name="tags" value="Care Notes/Logs"> Care Notes/Logs</label>
            <label><input type="checkbox" name="tags" value="Audits/Compliance"> Audits/Compliance</label>
            <label><input type="checkbox" name="tags" value="Handovers"> Handovers</label>
            <label><input type="checkbox" name="tags" value="Training"> Training</label>
            <label><input type="checkbox" name="tags" value="Family Communication"> Family Communication</label>
            <label><input type="checkbox" id="fOther" value="__OTHER__"> Other</label>
          </div>
          <input id="fOtherText" class="mt-2 w-full rounded-xl border border-slate-600 bg-[var(--navy-2)] px-4 py-3 text-slate-100 hidden" placeholder="Specify other‚Ä¶" />
        </fieldset>
        <div class="flex items-center gap-3 relative justify-end">
          <button id="fullSaveBtn" class="btn btn-gold px-7 py-3 text-lg" type="submit">Save entry</button>
          <div id="fullEntryToast" class="entry-toast">Thank you for trusting me with this! üòâ</div>
        </div>
        <div class="rounded-xl border border-slate-700 p-4">
          <div class="flex items-center gap-2">
            <span class="badge">Private</span>
            <p class="font-semibold">The Locker-Room Vent (your private bench)</p>
          </div>
          <p class="text-sm text-slate-300 mt-1"><strong>Busy often means Overwhelmed.</strong> Offload the mental barbell here. Nothing in this box ever leaves this page ‚Äî not saved, not sent.</p>
          <textarea id="ventBox" rows="3" class="mt-3 w-full rounded-xl border border-slate-600 bg-[var(--navy-2)] px-4 py-3 text-slate-100" placeholder="Optional: let it out. We won‚Äôt transmit or store this."></textarea>
        </div>
      </form>
    </section>
  </div>

  <script>
    const PASSWORD = "Daddy";
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbwgdKeJ5LdG9AhieYqmzA8L2uYgSjXkpHsdsVF9tFSWSJgzEvLK4Vr-oJcz6erQTK4VJg/exec";
    const MAX_SECONDS = 120;

    const gate=document.getElementById('gate'), diary=document.getElementById('diary'), gateForm=document.getElementById('gateForm');
    const lockStatus=document.getElementById('lockStatus'), rememberMe=document.getElementById('rememberMe');
    const quickBtn=document.getElementById('quickBtn'), fullBtn=document.getElementById('fullBtn');
    const quickForm=document.getElementById('quickForm'), fullForm=document.getElementById('fullForm');
    const qOther=document.getElementById('qOther'), qOtherText=document.getElementById('qOtherText');
    const fOther=document.getElementById('fOther'), fOtherText=document.getElementById('fOtherText');
    const ventBox=document.getElementById('ventBox');
    const quickSaveBtn=document.getElementById('quickSaveBtn'), fullSaveBtn=document.getElementById('fullSaveBtn');
    const quickEntryToast=document.getElementById('quickEntryToast'), fullEntryToast=document.getElementById('fullEntryToast');
    let sos=false, audioBlob=null;

    gateForm.addEventListener('submit',e=>{e.preventDefault();if(gateForm.querySelector('input').value===PASSWORD){if(rememberMe.checked)localStorage.setItem('diary_unlocked','true');gate.classList.add('hidden');diary.classList.remove('hidden');lockStatus.textContent='üîì Unlocked';}else alert('Incorrect password');});
    quickBtn.addEventListener('click',()=>{quickBtn.classList.add('chip-active');fullBtn.classList.remove('chip-active');quickForm.classList.remove('hidden');fullForm.classList.add('hidden');});
    fullBtn.addEventListener('click',()=>{fullBtn.classList.add('chip-active');quickBtn.classList.remove('chip-active');fullForm.classList.remove('hidden');quickForm.classList.add('hidden');});
    qOther.addEventListener('change',()=>{qOtherText.classList.toggle('hidden',!qOther.checked);});
    fOther.addEventListener('change',()=>{fOtherText.classList.toggle('hidden',!fOther.checked);});

    function bounce(el){el.classList.remove('btn-bounce');void el.offsetWidth;el.classList.add('btn-bounce');}
    function showToast(el){el.classList.remove('show');void el.offsetWidth;el.classList.add('show');setTimeout(()=>el.classList.remove('show'),3000);}
    function collectTags(formEl,otherChecked,otherTextEl){const fd=new FormData(formEl);let tags=fd.getAll('tags');if(otherChecked&&otherTextEl.value.trim())tags.push("Other: "+otherTextEl.value.trim());return tags;}

    quickForm.addEventListener('submit',async e=>{e.preventDefault();const fd=new FormData(quickForm);const payload={mode:'quick',timestamp:new Date().toISOString(),what_happened:fd.get('pain_point')||'',ideal:fd.get('proposed_solution')||'',tags:collectTags(quickForm,qOther.checked,qOtherText),sos:!!sos,audioDataURL:null};try{await fetch(ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});showToast(quickEntryToast);bounce(quickSaveBtn);}catch{alert('Saved locally');showToast(quickEntryToast);bounce(quickSaveBtn);}quickForm.reset();qOther.checked=false;qOtherText.classList.add('hidden');});
    fullForm.addEventListener('submit',async e=>{e.preventDefault();const fd=new FormData(fullForm);const payload={mode:'full',timestamp:new Date().toISOString(),mood:fd.get('mood')||'',what_happened:fd.get('pain_point')||'',ideal:fd.get('ideal')||'',tags:collectTags(fullForm,fOther.checked,fOtherText),sos:!!sos,audioDataURL:null};try{await fetch(ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});showToast(fullEntryToast);bounce(fullSaveBtn);}catch{alert('Saved locally');showToast(fullEntryToast);bounce(fullSaveBtn);}fullForm.reset();fOther.checked=false;fOtherText.class
